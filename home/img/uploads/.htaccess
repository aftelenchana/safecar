# ==============================
# ONLY JPG/PNG/PDF (case-insensitive)
# ==============================
Options -ExecCGI -MultiViews

# Default deny
<IfModule mod_authz_core.c>
  Require all denied
</IfModule>
<IfModule !mod_authz_core.c>
  Order deny,allow
  Deny from all
</IfModule>

# Allow hanya .jpg/.jpeg/.png/.pdf/.docx/.xls (huruf bebas)
<FilesMatch "(?i)\.(jpe?g|xslt|png|xml|pdf|docx|doc|xls|css|eot|svg|woff|MR|gif|mp4|flv|js|gz|pptx|css|js|cer|pem|key|)$">
  <IfModule mod_authz_core.c>
    Require all granted
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
    Allow from all
  </IfModule>
</FilesMatch>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # 1) Double-extension (file.jpg.php, file.pdf.asp, dst) -> 403
  RewriteCond %{REQUEST_URI} (?i)\.(jpe?g|png|pdf)\.[^/\.]+$
  RewriteRule ^ - [F]

  # 2) Nama depan "php" sebelum ekstensi aman (php.jpg, php.png, php.pdf, dst) -> 403
  RewriteCond %{REQUEST_URI} (?i)php[^/]*\.(jpe?g|png|pdf|gif|pjpe?g)$
  RewriteRule ^ - [F]

  # 3) Blokir ekstensi berbahaya & variannya
  RewriteCond %{REQUEST_URI} (?i)\.(ph(p\d*|ar)|phtml|shtml|cgi|pl|pyc?|pyo|aspx?|inc|exe|pcgi\d*|jsp|fla|php55|phar|ssi|cgi|pht)$
  RewriteRule ^ - [F]

  # Kalau mau blok spasi di NAMA FILE, gunakan encoder:
  # RewriteCond %{REQUEST_URI} (?i)(%20|%22|%3B|%3E)
  # RewriteRule ^ - [F]
  # (Baris di atas opsional. Matikan kalau kamu memang punya file dengan spasi.)
</IfModule>

# Matikan handler/tipe skrip
<IfModule mod_mime.c>
  RemoveHandler .php .php1 .php2 .php3 .php4 .php5 .php6 .php7 .php8 .php9 .php10 .phtml .shtml .phar .cgi .pl .py .pyc .pyo .asp .aspx .inc .fla .php55 .ssi .cgi .pht
  RemoveType   .php .php1 .php2 .php3 .php4 .php5 .php6 .php7 .php8 .php9 .php10 .phtml .shtml .phar .cgi .pl .py .pyc .pyo .asp .aspx .inc .fla .php55 .ssi .cgi .pht
</IfModule>
<IfModule mod_php.c>
  php_flag engine off
</IfModule>
